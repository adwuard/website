"use strict";(self.webpackChunkchaos_mesh_website=self.webpackChunkchaos_mesh_website||[]).push([[2703],{7857:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>_});const i=JSON.parse('{"id":"tkl-api/tkl_timer","title":"HW Timer Driver","description":"Brief Description","source":"@site/i18n/zh/docusaurus-plugin-content-docs/current/tkl-api/tkl_timer.md","sourceDirName":"tkl-api","slug":"/tkl-api/tkl_timer","permalink":"/website/zh/docs/tkl-api/tkl_timer","draft":false,"unlisted":false,"editUrl":"https://github.com/tuya/TuyaOpen/edit/master/i18n/zh/docusaurus-plugin-content-docs/current/tkl-api/tkl_timer.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Thread","permalink":"/website/zh/docs/tkl-api/tkl_thread"},"next":{"title":"UART Driver","permalink":"/website/zh/docs/tkl-api/tkl_uart"}}');var r=t(4848),s=t(8453);const l={},c="HW Timer Driver",d={},_=[{value:"Brief Description",id:"brief-description",level:2},{value:"API Description",id:"api-description",level:2},{value:"tkl_timer_init",id:"tkl_timer_init",level:3},{value:"TKL_TIMER_MODE_E:",id:"tkl_timer_mode_e",level:4},{value:"tkl_timer_deinit",id:"tkl_timer_deinit",level:3},{value:"tkl_timer_start",id:"tkl_timer_start",level:3},{value:"tkl_timer_stop",id:"tkl_timer_stop",level:3},{value:"tkl_timer_get",id:"tkl_timer_get",level:3},{value:"tkl_timer_get_current_value",id:"tkl_timer_get_current_value",level:3},{value:"Example",id:"example",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"hw-timer-driver",children:"HW Timer Driver"})}),"\n",(0,r.jsx)(n.h2,{id:"brief-description",children:"Brief Description"}),"\n",(0,r.jsx)(n.p,{children:"A timer is an on-chip peripheral in a microprocessor used for time measurement. Depending on the actual configuration requirements, timers usually have different timing precisions, such as 16-bit, 32-bit, etc. In actual use, it is usually necessary to configure parameters such as the timing period, counting method, and interrupt service routine."}),"\n",(0,r.jsx)(n.h2,{id:"api-description",children:"API Description"}),"\n",(0,r.jsx)(n.h3,{id:"tkl_timer_init",children:"tkl_timer_init"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_timer_init(TUYA_TIMER_NUM_E timer_id, TUYA_TIMER_BASE_CFG_T *cfg);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Function Description:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Initializes the corresponding timer instance based on the port number and basic configuration, and returns the initialization result."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Parameters:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"timer_id"}),": Port number."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"cfg"}),": Timer basic configuration, including timing mode, callback function, and callback function parameters."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"typedef struct {\n    TKL_TIMER_MODE_E    mode;\n    TKL_TIMER_ISR_CB    cb;\n    void                *args;\n} TUYA_TIMER_BASE_CFG_T;\n"})}),"\n",(0,r.jsx)(n.h4,{id:"tkl_timer_mode_e",children:"TKL_TIMER_MODE_E:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Name"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Definition"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Remarks"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"TKL_TIMER_MODE_ONCE"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"One-shot timer"}),(0,r.jsx)(n.td,{style:{textAlign:"left"}})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"TKL_TIMER_MODE_PERIOD"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Periodic timer"}),(0,r.jsx)(n.td,{style:{textAlign:"left"}})]})]})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Return Value:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OPRT_OK for success, others please refer to the file ",(0,r.jsx)(n.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tkl_timer_deinit",children:"tkl_timer_deinit"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_timer_deinit(TUYA_TIMER_NUM_E timer_id);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Function Description:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Deinitializes the timer instance."}),"\n",(0,r.jsx)(n.li,{children:"This interface stops the timer and releases the software and hardware resources related to the timer."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Parameters:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"timer_id"}),": Port number."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Return Value:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OPRT_OK for success, others please refer to the file ",(0,r.jsx)(n.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tkl_timer_start",children:"tkl_timer_start"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_timer_start(TUYA_TIMER_NUM_E timer_id, uint32_t us);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Function Description:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Starts the timer."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Parameters:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"timer_id"}),": Port number."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"us"}),": Timer interval."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Return Value:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OPRT_OK for success, others please refer to the file ",(0,r.jsx)(n.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tkl_timer_stop",children:"tkl_timer_stop"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_timer_stop(TKL_TIMER_PORT_E port);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Function Description:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stops the timer."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Parameters:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"port"}),": Port number."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Return Value:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OPRT_OK for success, others please refer to the file ",(0,r.jsx)(n.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tkl_timer_get",children:"tkl_timer_get"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_timer_get(TKL_TIMER_PORT_E port, uint32_t *us);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Function Description:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Gets the timer interval."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Parameters:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"port"}),": Port number."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"us"}),": Timer interval value, in microseconds, corresponding to the value set in tkl_timer_start."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Return Value:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OPRT_OK for success, others please refer to the file ",(0,r.jsx)(n.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tkl_timer_get_current_value",children:"tkl_timer_get_current_value"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"OPERATE_RET tkl_timer_get_current_value(TUYA_TIMER_NUM_E timer_id, uint32_t *us);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Function Description:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Gets the current count value of the timer."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Parameters:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"timer_id"}),": Port number."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"us"}),": Current count value, in microseconds."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Return Value:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OPRT_OK for success, others please refer to the file ",(0,r.jsx)(n.code,{children:"tuya_error_code.h"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'static void tkl_timer_isr_cb_fun(void *args)\n{\n\tPR_NOTICE("hw_timer test");\n}\n\nvoid tuya_timer_test(void)\n{\n    OPERATE_RET ret;\n    TUYA_TIMER_BASE_CFG_T cfg;\n    uint32_t interval_us;\n    uint32_t get_us;\n\n    cfg.mode = TUYA_TIMER_MODE_PERIOD;\n    cfg.cb = tkl_timer_isr_cb_fun;\n    cfg.arg = NULL;\n\n    ret = tkl_timer_init(TUYA_TIMER_NUM_0, &cfg);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    ret = tkl_timer_start(TUYA_TIMER_NUM_0, 1000);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    tkl_system_delay(5000);\n    ret = tkl_timer_stop(TUYA_TIMER_NUM_0);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    ret = tkl_timer_get(TUYA_TIMER_NUM_0, &interval_us);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n\tif(interval_us != 2000){\n        interval_us = 2000;\n    }\n    ret = tkl_timer_start(TUYA_TIMER_NUM_0, interval_us);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    tkl_system_delay(1000);\n    ret = tkl_timer_get_current_value(TUYA_TIMER_NUM_0, &get_us);\n    if (ret != OPRT_OK) {\n        //fail\n        return;\n    }\n    PR_DEBUG("current run time:%d us", get_us);\n    tkl_system_delay(5000);\n    //uninitialize timer\n    ret = tkl_timer_deinit(TUYA_TIMER_NUM_0);\n    if (ret != 0) {\n       //failed\n    }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>c});var i=t(6540);const r={},s=i.createContext(r);function l(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);